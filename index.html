<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MYUSDT Dashboard (Coming Soon)</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/web3@1.9.0/dist/web3.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    /* Wallet Picker Modal Styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 999;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      max-width: 320px;
      width: 90%;
      text-align: center;
    }
    .wallet-option {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      margin: 8px 0;
      border: 2px solid #eee;
      border-radius: 8px;
      cursor: pointer;
      transition: border-color 0.2s;
    }
    .wallet-option:hover {
      border-color: #f0b90b;
    }
    .wallet-option img {
      width: 32px;
      height: 32px;
    }
  </style>
</head>
<body>
  <header>
    <div class="header-container">
      <img src="https://myusdt.github.io/usdt/myusdtlogo.png" alt="MYUSDT Logo" class="logo">
      <h1>MYUSDT Multi-Chain Dashboard</h1>
      <nav>
        <a href="index.html">Home</a> |
        <a href="liquidity.html">Liquidity</a> |
        <a href="bridge.html">Bridge</a>
      </nav>
    </div>
  </header>

  <main>
    <!-- Token Overview -->
    <section class="card">
      <h2>Token Overview</h2>
      <p><strong>Symbol:</strong> MYUSDT</p>
      <p><strong>Total Supply:</strong> <span id="totalSupply">Loading...</span></p>
      <p><strong>Decimals:</strong> 18</p>
    </section>

    <!-- Wallet Info -->
    <section class="card">
      <h2>Your Wallet</h2>
      <p><strong>Address:</strong> <span id="walletAddress">Not connected</span></p>
      <p><strong>Balance:</strong> <span id="userBalance">Loading...</span></p>
      <button id="connectBtn">üîó Connect Wallet</button>
      <button id="switchBscBtn">üåê Switch to BSC</button>
      <button id="addTokenBtn">‚ûï Add MYUSDT</button>
      <p id="statusMsg"></p>
    </section>

    <!-- QR Code for Instant Add -->
    <section class="card">
      <h2>üì± Quick Add via QR Code</h2>
      <p>Scan this QR code in your wallet‚Äôs browser to instantly add MYUSDT:</p>
      <a href="https://myusdt.github.io/usdt/add.html" target="_blank">
        <img 
          src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=https://myusdt.github.io/usdt/add.html" 
          alt="Add MYUSDT QR Code"
          style="margin-top:10px; border: 4px solid #f0b90b; border-radius: 8px;"
        >
      </a>
      <p style="font-size:0.9em; color:#555; margin-top:8px;">
        Tip: Open your wallet app, go to its QR scanner, and scan this code.
      </p>
    </section>
  </main>

  <footer>
    <div class="refresh-section">
      <button id="refresh-btn">üîÑ Refresh Now</button>
      <p id="last-updated"></p>
    </div>
    <p>Powered by Web3.js & ethers.js | MYUSDT Multi-Chain Dashboard</p>
  </footer>

  <!-- Wallet Picker Modal -->
  <div class="modal" id="walletModal">
    <div class="modal-content">
      <h3>Select a Wallet</h3>
      <div id="walletList"></div>
    </div>
  </div>

  <script>
    const TOKEN = {
      address: "0x36FEDA9142B7b72BB46b613Fe68844c50B0AC34b",
      symbol: "USDT", // must match contract's on-chain symbol
      decimals: 18,
      image: "https://myusdt.github.io/usdt/myusdtlogo.png"
    };

    const BSC_PARAMS = {
      chainId: "0x38",
      chainName: "BNB Smart Chain",
      nativeCurrency: { name: "BNB", symbol: "BNB", decimals: 18 },
      rpcUrls: ["https://bsc-dataseed.binance.org"],
      blockExplorerUrls: ["https://bscscan.com"]
    };

    const statusEl = document.getElementById("statusMsg");
    const setStatus = (msg) => statusEl.textContent = msg;

    const getProvider = () => {
      const eth = window.ethereum;
      if (!eth) {
        alert("No wallet found. Install MetaMask or a compatible wallet.");
        return null;
      }
      return eth;
    };

    document.getElementById("connectBtn").onclick = async () => {
      try {
        const eth = getProvider();
        if (!eth) return;
        const accounts = await eth.request({ method: "eth_requestAccounts" });
        document.getElementById("walletAddress").textContent = accounts[0];
        setStatus(`‚úÖ Connected: ${accounts[0]}`);
      } catch (e) {
        console.error(e);
        setStatus(`‚ùå Connect failed: ${e.message || e}`);
      }
    };

    async function ensureBsc() {
      const eth = getProvider();
      if (!eth) return false;
      try {
        const currentChainId = await eth.request({ method: "eth_chainId" });
        if (currentChainId !== BSC_PARAMS.chainId) {
          try {
            await eth.request({
              method: "wallet_switchEthereumChain",
              params: [{ chainId: BSC_PARAMS.chainId }]
            });
          } catch (switchErr) {
            if (switchErr.code === 4902) {
              await eth.request({
                method: "wallet_addEthereumChain",
                params: [BSC_PARAMS]
              });
            } else {
              throw switchErr;
            }
          }
        }
        return true;
      } catch (e) {
        console.error(e);
        setStatus(`‚ùå Chain switch failed: ${e.message || e}`);
        return false;
      }
    }

    // Multi-wallet detection
    const providers = [];
    window.addEventListener("eip6963:announceProvider", (event) => {
      providers.push(event.detail.provider);
    });
    window.dispatchEvent(new Event("eip6963:requestProvider"));

    function showWalletModal() {
      const modal = document.getElementById("walletModal");
      const walletList = document.getElementById("walletList");
      walletList.innerHTML = "";

      if (providers.length === 0) {
        setStatus("‚ùå No wallets detected. Please open in MetaMask, Trust Wallet, etc.");
        return;
      }

      providers.forEach((p) => {
        const option = document.createElement("div");
        option.className = "wallet-option";
        option.innerHTML = `
          <img src="${p.info.icon}" alt="${p.info.name} logo">
          <span>${p.info.name}</span>
        `;
        option.onclick = () => {
          modal.style.display = "none";
          addTokenWithProvider(p);
        };
        walletList.appendChild(option);
      });

      modal.style.display = "flex";
    }

    async function addTokenWithProvider(provider) {
      try {
        const ok = await ensureBsc();
        if (!ok) return;
        const wasAdded = await provider.request({
          method: "wallet_watchAsset",
          params: { type: "ERC20", options: TOKEN }
        });
        setStatus(wasAdded ? "üéâ MYUSDT added to wallet!" : "‚ÑπÔ∏è User canceled add");
      } catch (e) {
        console.error(e);
        setStatus(`‚ùå Add token failed: ${e.message || e}`);
      }
    }

    document.getElementById("addTokenBtn").onclick = () => {
  setTimeout(showWalletModal, 300);
};
