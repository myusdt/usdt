<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MYUSDT Dashboard</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/web3@1.9.0/dist/web3.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>
  <header>
    <div class="header-container">
      <img src="https://myusdt.github.io/usdt/myusdt_logo.png" alt="MYUSDT Logo" class="logo">
      <h1>MYUSDT Multi-Chain Dashboard</h1>
      <nav>
        <a href="index.html">Home</a> |
        <a href="liquidity.html">Liquidity</a> |
        <a href="bridge.html">Bridge</a>
      </nav>
    </div>
  </header>

  <main>
    <!-- Token Overview -->
    <section class="card">
      <h2>Token Overview</h2>
      <p><strong>Symbol:</strong> MYUSDT</p>
      <p><strong>Total Supply:</strong> <span id="totalSupply">Loading...</span></p>
      <p><strong>Decimals:</strong> 18</p>
    </section>

    <!-- Wallet Info -->
    <section class="card">
      <h2>Your Wallet</h2>
      <p><strong>Address:</strong> <span id="walletAddress">Not connected</span></p>
      <p><strong>Balance:</strong> <span id="userBalance">Loading...</span></p>
      <button id="connectBtn">ğŸ”— Connect Wallet</button>
      <button id="switchBscBtn">ğŸŒ Switch to BSC</button>
      <button id="addTokenBtn">â• Add MYUSDT</button>
      <p id="statusMsg"></p>
    </section>
  </main>

  <footer>
    <div class="refresh-section">
      <button id="refresh-btn">ğŸ”„ Refresh Now</button>
      <p id="last-updated"></p>
    </div>
    <p>Powered by Web3.js & ethers.js | MYUSDT Multi-Chain Dashboard</p>
  </footer>

  <script>
    const TOKEN = {
      address: "0x5ff19C505CCA2fa457cBd060f0CB5473C8400E70",
      symbol: "MYUSDT",
      decimals: 18,
      image: "https://myusdt.github.io/usdt/myusdt_logo.png"
    };

    const BSC_PARAMS = {
      chainId: "0x38",
      chainName: "BNB Smart Chain",
      nativeCurrency: { name: "BNB", symbol: "BNB", decimals: 18 },
      rpcUrls: ["https://bsc-dataseed.binance.org"],
      blockExplorerUrls: ["https://bscscan.com"]
    };

    const statusEl = document.getElementById("statusMsg");
    const setStatus = (msg) => statusEl.textContent = msg;

    const getProvider = () => {
      const eth = window.ethereum;
      if (!eth) {
        alert("No wallet found. Install MetaMask or a compatible wallet.");
        return null;
      }
      return eth;
    };

    document.getElementById("connectBtn").onclick = async () => {
      try {
        const eth = getProvider();
        if (!eth) return;
        const accounts = await eth.request({ method: "eth_requestAccounts" });
        document.getElementById("walletAddress").textContent = accounts[0];
        setStatus(`âœ… Connected: ${accounts[0]}`);
      } catch (e) {
        console.error(e);
        setStatus(`âŒ Connect failed: ${e.message || e}`);
      }
    };

    async function ensureBsc() {
      const eth = getProvider();
      if (!eth) return false;
      try {
        const currentChainId = await eth.request({ method: "eth_chainId" });
        if (currentChainId !== BSC_PARAMS.chainId) {
          try {
            await eth.request({
              method: "wallet_switchEthereumChain",
              params: [{ chainId: BSC_PARAMS.chainId }]
            });
          } catch (switchErr) {
            if (switchErr.code === 4902) {
              await eth.request({
                method: "wallet_addEthereumChain",
                params: [BSC_PARAMS]
              });
            } else {
              throw switchErr;
            }
          }
        }
        return true;
      } catch (e) {
        console.error(e);
        setStatus(`âŒ Chain switch failed: ${e.message || e}`);
        return false;
      }
    }

    document.getElementById("switchBscBtn").onclick = async () => {
      const ok = await ensureBsc();
      setStatus(ok ? "ğŸŒ On BSC mainnet âœ…" : "âŒ Not on BSC");
    };

    document.getElementById("addTokenBtn").onclick = async () => {
      try {
        const eth = getProvider();
        if (!eth) return;
        const ok = await ensureBsc();
        if (!ok) return;
        const wasAdded = await eth.request({
          method: "wallet_watchAsset",
          params: {
            type: "ERC20",
            options: {
              address: TOKEN.address,
              symbol: TOKEN.symbol,
              decimals: TOKEN.decimals,
              image: TOKEN.image
            }
          }
        });
        setStatus(wasAdded ? "ğŸ‰ MYUSDT added to wallet!" : "â„¹ï¸ User canceled add");
      } catch (e) {
        console.error(e);
        setStatus(`âŒ Add token failed: ${e.message || e}`);
      }
    };
  </script>

  <script src="app.js"></script>
</body>
</html>
